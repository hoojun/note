# CSS 视觉格式化模型

## 定位方案（Positions schemes）

css 2.1 中，会根据三种定位方案来摆放框：

1. 正常排版。CSS 2.1 中，正常排版包括对块级框的块格式化，对行级框的行格式化，对块级框和行级框的相对定位。
2. 浮动。在浮动模型中，一个框先按照正常排版来摆放，再将它从排版流中取出并尽可能地向左或向右偏移。其它内容可以排在一个浮动的周围。
3. 绝对定位。在绝对定位模型中，一个框会从排版流中完全脱离出来（它对后续的兄弟没有影响），并相对其包含块来指定其位置。

如果一个元素是浮动、绝对定位或根元素，那么它被称为**排版流之外**（out of flow）的元素。如果一个元素不是排版流之外的元素，那么它被称为**排版流之内**（in-flow）的元素。元素A的排版流包括元素A以及这么一组元素：它们是排版流之内的元素，且它们在排版流之外最近的祖先是元素A。

## postion

取值：relative | absolute | fixed | inherit

初始：static

适用于：所有元素

继承：否

百分比：（不适用）

媒介：视觉

计算值：同指定值

**取值意义：**

- static

	元素生成的框是按正常排版方式来摆放的普通框。其'top'、'right'、'bottom' 与 'left' 属性不起作用。

- relatvie

	元素生成的框先按正常排版方式来计算其位置（这称作在正常排版下的位置），然后框相对于其正常位置进行偏移。若框 B 使用了相对定位，则会以假设框 B 还没有发生偏移之前的状态来计算其后面的框的位置。本规范未定义 'position: relative' 在table-row-group、table-header-group、table-footer-group、table-row、table-column-group、table-column、table-cell、and table-caption元素上的效果。

- absolute

	框的位置（可能包括大小）由 'top'、'right'、'bottom' 与 'left' 属性来指定。这些属性指定了框相对于其包含块的偏移量。绝对定位框会被排除在正常排版之外，这意味着它们对之后的兄弟框的布局没有影响。另外，虽然绝对定位框有外边距，这些外边距不与其他外边距折叠。

- fixed

	框的位置按照 'absolute' 模型来计算，但是框相对于某个参考位置固定。如同 'absolute' 模型，框的外边距不与别的外边距折叠。若媒介型态是手持、投影、萤幕、打字机或是电视，则框相对于视口固定，而并不随着卷轴移动。若媒介型态是打印机，则框要渲染在每一页，并相对于页面框渲染，就算页面透过视口阅读（举例来说，预览列印的时候），也是这样。


## 正常排版（Normal flow）

框在正常排版中必然属于一个格式化上下文，要么是块格式化上下文，要么是行格式化上下文。块级框参与块格式化上下文。行级框参与行格式化上下文。

### 块格式化上下文 Block formatting contexts

有这几种框会为其内容创建新的块格式化上下文：浮动框、绝对定位框、非块框的块容器(inline-block)、'overflow'属性非'visible'的块框。

下面的情况会产生新的BFC:

- 根元素或其它包含它的元素
- 浮动 (元素的 float 不为 none)
- 绝对定位元素 (元素的 position 为 absolute 或 fixed)
- 行内块 inline-blocks (元素的 display: inline-block)
- 表格单元格 (元素的 display: table-cell，HTML表格单元格默认属性)
- 表格标题 (元素的 display: table-caption, HTML表格标题默认属性)
- overflow 的值不为 visible的元素
- 弹性盒 flex boxes (元素的 display: flex 或 inline-flex)

在块格式化上下文中，框会从包含块的顶部开始，一个接一个地，垂直向下地摆放。两个兄弟框之间的垂直距离由 'margin' 属性来决定。在同一个块格式化上下文中，相邻的块级框之间的垂直外边距会出现折叠。

在块格式化上下文中，每个框的左外边距边要紧贴其包含块的左边。即使在有浮动的情景下也是如此，除非框创建了一个新的块格式化上下文(在这种情况下该框可能会为了避开浮动框而变窄)。

**范围**

一个BFC包含创建该上下文元素的所有子元素，但不包括创建了新BFC的子元素的内部元素。

**特性**

BFC最显著的效果是建立一个隔离的空间，断绝空间内外元素相互的作用。当然，还有更多的特性：

- 内部的盒会在垂直方向一个接一个排列（可以看作BFC中有一个的常规流）；
- 处于同一个BFC中的元素相互影响，可能会发生margin collapse；
- 每个元素的margin box的左边，与容器块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此；
- BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素，反之亦然；
- 计算BFC的高度时，考虑BFC所包含的所有元素，连浮动元素也参与计算；
- 浮动盒区域不叠加到BFC上；


### 相对定位 Relative positioning

当一个框按照正常排版或浮动来摆放好之后，它就可能相对当时的位置再有所偏移，这被称作相对定位。以这种方式使一个框(B1)发生偏移，对跟随其后的框(B2)没有影响：B2的定位就好像B1还没有偏移，并且在B1应用了偏移后B2不进行重新定位。这意味着相对定位会导致框重叠。然而，如果相对定位导致 `overflow:auto` 或 `overflow:scroll` 的框溢出，则用户代理必须允许通过创建滚动条来使用户访问到这些内容(在它的偏移后位置上)，这可能会影响布局。

对于相对定位元素，'left'和'right'属性会在不改变其框尺寸的情况下水平地移动框。'Left'向右边移动框，并且'right'向左边移动框。框不会由于'left'或'right'属性而被分割或被拉伸，因此使用的值总是`left=-right`。

如果'left'和'right'值都是'auto'(它们的初始值)，则其使用值就是'0'(也就是框在它们的初始位置)。

如果'left'值是'auto'，则其使用值是'right'属性值的负数(也就是框通过'right'值向左移动)。

如果'right'的指定值为'auto'，则其使用值是'left'属性值的负数。

如果'left'或'right'的取值都不是'auto'，则对其位置的约束过多，因此要忽略其中的一个值。如果包含块的'direction'为'ltr'，则'left'胜出，而'right'值变为-'left'(left的负值)。如果包含块的'direction'为'rtl'，则'right'胜出，而'left'值被忽略。

因此下面的三个规则是等价的：

```
div.a8 { position: relative; direction: ltr; left: -1em; right: auto }
div.a8 { position: relative; direction: ltr; left: auto; right: 1em }
div.a8 { position: relative; direction: ltr; left: -1em; right: 5em } 
```

'top'和'bottom'属性会在不改变其框尺寸的情况下上下移动相对定位元素。'Top'把框向上移动，'bottom'把框向下移动。因为框不会由于'top'或'bottom'值而被分割或被拉伸，其使用值总是:top=-bottom。如果它们都是'auto'，则它们的使用值都为'0'。如果它们中的一个是'auto'，则它成为另一个的负值。如果两者都不是'auto'，则'bottom'被忽略(也就是，bottom的使用值为'top'的负值)。

## 浮动 Floats

在当前行向左或右偏移的框就是浮动框。浮动框最有趣的特点是其它内容可以紧挨着它的一侧来排版 (也可以通过'clear'属性来禁止这样排版)。内容会紧挨着左浮框的右侧排版，而紧挨着右浮框的左侧排版。





